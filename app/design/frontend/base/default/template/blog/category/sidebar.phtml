<?php
/**
 * Maho
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2026 Maho (https://mahocommerce.com)
 * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/** @var Maho_Blog_Block_Category_Sidebar $this */
$tree = $this->getCategoryTree();
$currentId = $this->getCurrentCategoryId();

if (empty($tree)) {
    return;
}
?>

<div class="block block-layered-nav blog-categories">
    <div class="block-content">
        <dl>
            <dt><?= $this->__('Categories') ?></dt>
            <dd>
                <?php
                $renderTree = function (array $nodes, int $currentId = null) use (&$renderTree) {
                    echo '<ol>';
                    foreach ($nodes as $node) {
                        $category = $node['category'];
                        $isActive = $currentId && (int) $category->getId() === $currentId;
                        $class = $isActive ? ' class="active"' : '';
                        echo '<li' . $class . '>';
                        echo '<a href="' . $category->getUrl() . '">' . $this->escapeHtml($category->getName()) . '</a>';
                        if (!empty($node['children'])) {
                            $renderTree($node['children'], $currentId);
                        }
                        echo '</li>';
                    }
                    echo '</ol>';
                };
                $renderTree($tree, $currentId);
                ?>
            </dd>
        </dl>
    </div>
</div>
