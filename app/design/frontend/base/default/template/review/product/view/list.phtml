<?php
/**
 * Maho
 *
 * @package     base_default
 * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://magento.com)
 * @copyright   Copyright (c) 2021-2023 The OpenMage Contributors (https://openmage.org)
 * @copyright   Copyright (c) 2024-2026 Maho (https://mahocommerce.com)
 * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/** @var Mage_Review_Block_Product_View_List $this */
?>

<?php $_items = $this->getReviewsCollection()->getItems() ?>
<?php $userIcon = $this->getIconSvg('user') ?>
<div class="box-collateral box-reviews" id="customer-reviews">
    <?php if (count($_items)): ?>
        <div class="rv-header">
            <span class="rv-count"><?= $this->__('%d Review(s)', count($_items)) ?></span>
            <button type="button" class="button" onclick="document.getElementById('review-dialog').showModal()">
                <?= $this->__('Write a Review') ?>
            </button>
        </div>
        <div class="rv-list">
        <?php foreach ($_items as $_review): ?>
            <?php $_votes = $_review->getRatingVotes() ?>
            <article class="rv-card">
                <header class="rc-header">
                    <div class="rc-author">
                        <span class="rc-avatar"><?= $userIcon ?></span>
                        <div class="rc-meta">
                            <span class="rc-name"><?= $this->escapeHtml($_review->getNickname()) ?></span>
                            <time class="rc-date"><?= $this->formatDate($_review->getCreatedAt()) ?></time>
                        </div>
                    </div>
                    <?php if (count($_votes) == 1): ?>
                        <?php foreach ($_votes as $_vote): ?>
                            <div class="rc-rating">
                                <div class="rating-box">
                                    <div class="rating" style="width:<?= $_vote->getPercent() ?>%"></div>
                                </div>
                            </div>
                        <?php endforeach ?>
                    <?php endif ?>
                </header>
                <div class="rc-content">
                    <h4 class="rc-title"><?= $this->escapeHtml(ucfirst($_review->getTitle())) ?></h4>
                    <p class="rc-text"><?= nl2br($this->escapeHtml(ucfirst($_review->getDetail()))) ?></p>
                </div>
                <?php if (count($_votes) > 1): ?>
                <footer class="rc-footer">
                    <div class="rc-ratings">
                        <?php foreach ($_votes as $_vote): ?>
                        <div class="rc-rating-item">
                            <span class="rc-rating-label"><?= $this->escapeHtml($_vote->getRatingCode()) ?></span>
                            <div class="rating-box">
                                <div class="rating" style="width:<?= $_vote->getPercent() ?>%"></div>
                            </div>
                        </div>
                        <?php endforeach ?>
                    </div>
                </footer>
                <?php endif ?>
            </article>
        <?php endforeach ?>
        </div>
    <?php elseif($this->getParentBlock()): ?>
        <div class="rv-header empty">
            <?php
            /** @var Mage_Catalog_Block_Product_Abstract $parent */
            $parent = $this->getParentBlock();
            ?>
            <?= $parent->getReviewsSummaryHtml($this->getProduct(), 'short', true) ?>
            <button type="button" class="button" onclick="document.getElementById('review-dialog').showModal()">
                <?= $this->__('Be the First to Review') ?>
            </button>
        </div>
    <?php endif ?>
    <?= $this->getChildHtml('review_form') ?>
</div>
