<?php
/**
 * Maho
 *
 * @package     base_default
 * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://magento.com)
 * @copyright   Copyright (c) 2021-2023 The OpenMage Contributors (https://openmage.org)
 * @copyright   Copyright (c) 2024-2026 Maho (https://mahocommerce.com)
 * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/** @var Mage_Review_Block_Product_View_List $this */
?>

<?php $_items = $this->getReviewsCollection()->getItems() ?>
<?php $userIcon = $this->getIconSvg('user') ?>
<div class="box-collateral box-reviews" id="customer-reviews">
    <?php if (count($_items)): ?>
        <div class="reviews-header">
            <span class="reviews-count"><?= $this->__('%d Review(s)', count($_items)) ?></span>
            <button type="button" class="button" onclick="document.getElementById('review-dialog').showModal()">
                <?= $this->__('Write a Review') ?>
            </button>
        </div>
        <div class="reviews-list">
        <?php foreach ($_items as $_review): ?>
            <?php $_votes = $_review->getRatingVotes() ?>
            <article class="review-card">
                <header class="review-card__header">
                    <div class="review-card__author">
                        <span class="review-card__avatar"><?= $userIcon ?></span>
                        <div class="review-card__meta">
                            <span class="review-card__name"><?= $this->escapeHtml($_review->getNickname()) ?></span>
                            <time class="review-card__date"><?= $this->formatDate($_review->getCreatedAt()) ?></time>
                        </div>
                    </div>
                    <?php if (count($_votes) == 1): ?>
                        <?php foreach ($_votes as $_vote): ?>
                            <div class="review-card__rating">
                                <div class="rating-box">
                                    <div class="rating" style="width:<?= $_vote->getPercent() ?>%"></div>
                                </div>
                            </div>
                        <?php endforeach ?>
                    <?php endif ?>
                </header>
                <div class="review-card__content">
                    <h4 class="review-card__title"><?= $this->escapeHtml(ucfirst($_review->getTitle())) ?></h4>
                    <p class="review-card__text"><?= nl2br($this->escapeHtml(ucfirst($_review->getDetail()))) ?></p>
                </div>
                <?php if (count($_votes) > 1): ?>
                <footer class="review-card__footer">
                    <div class="review-card__ratings">
                        <?php foreach ($_votes as $_vote): ?>
                        <div class="review-card__rating-item">
                            <span class="review-card__rating-label"><?= $this->escapeHtml($_vote->getRatingCode()) ?></span>
                            <div class="rating-box">
                                <div class="rating" style="width:<?= $_vote->getPercent() ?>%"></div>
                            </div>
                        </div>
                        <?php endforeach ?>
                    </div>
                </footer>
                <?php endif ?>
            </article>
        <?php endforeach ?>
        </div>
    <?php elseif($this->getParentBlock()): ?>
        <div class="reviews-header reviews-header--empty">
            <?= $this->getParentBlock()->getReviewsSummaryHtml($this->getProduct(), 'short', true) ?>
            <button type="button" class="button" onclick="document.getElementById('review-dialog').showModal()">
                <?= $this->__('Be the First to Review') ?>
            </button>
        </div>
    <?php endif ?>
    <?= $this->getChildHtml('review_form') ?>
</div>
