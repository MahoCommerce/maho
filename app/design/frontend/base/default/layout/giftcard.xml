<?xml version="1.0"?>
<!--
/**
 * Maho
 *
 * @category   Maho
 * @package    Maho_Giftcard
 * @copyright  Copyright (c) 2025-2026 Maho (https://mahocommerce.com)
 * @license    https://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
-->
<layout>
    <!-- Checkout Payment - Add gift card form and handle payment method selection -->
    <checkout_onepage_index>
        <!-- Add gift card form to payment step (rendered via methods_additional before payment methods) -->
        <reference name="checkout.onepage.payment.methods_additional">
            <block type="giftcard/checkout_payment_giftcard" name="checkout.payment.giftcard" template="maho/giftcard/checkout/payment/giftcard.phtml" />
        </reference>
        <!-- Handle payment method visibility based on gift card coverage -->
        <reference name="checkout.onepage.payment.methods">
            <block type="core/template" name="giftcard.payment.methods" template="maho/giftcard/checkout/payment/methods.phtml" />
        </reference>
    </checkout_onepage_index>

    <!-- Checkout Payment Method AJAX Load - Include gift card form -->
    <checkout_onepage_paymentmethod>
        <reference name="checkout.onepage.payment.methods.additional">
            <block type="giftcard/checkout_payment_giftcard" name="checkout.payment.giftcard.ajax" template="maho/giftcard/checkout/payment/giftcard.phtml" />
        </reference>
        <reference name="root">
            <block type="core/template" name="giftcard.payment.methods.ajax" template="maho/giftcard/checkout/payment/methods.phtml" />
        </reference>
    </checkout_onepage_paymentmethod>

    <!-- Checkout Cart - Add Gift Card Form -->
    <checkout_cart_index>
        <!-- Add to the extra section where discount codes appear -->
        <reference name="checkout.cart.extra">
            <block type="giftcard/checkout_cart_giftcard" name="checkout.cart.giftcard" as="giftcard" template="maho/giftcard/checkout/cart/giftcard.phtml" />
        </reference>
    </checkout_cart_index>

    <!-- Gift Card Product View -->
    <PRODUCT_TYPE_giftcard>
        <reference name="product.info">
            <block type="giftcard/catalog_product_view_type_giftcard" name="product.info.giftcard" as="product_type_data" template="catalog/product/view/type/default.phtml">
                <block type="core/text_list" name="product.info.giftcard.extra" as="product_type_data_extra" translate="label">
                    <label>Product Extra Info</label>
                </block>
            </block>
        </reference>
        <reference name="product.info.options.wrapper">
            <block type="giftcard/catalog_product_view_type_giftcard" name="product.info.options.giftcard" as="options_giftcard" before="-" template="maho/giftcard/catalog/product/view/type/options/giftcard.phtml" />
        </reference>
    </PRODUCT_TYPE_giftcard>
</layout>
