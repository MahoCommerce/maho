<?xml version="1.0"?>
<!--
/**
 * Maho
 *
 * @category   Maho
 * @package    Maho_Giftcard
 * @copyright  Copyright (c) 2025-2026 Maho (https://mahocommerce.com)
 * @license    https://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
-->
<layout>
    <!-- Gift Card Grid Page -->
    <adminhtml_giftcard_index>
        <reference name="content">
            <block type="giftcard/adminhtml_giftcard" name="giftcard" />
        </reference>
    </adminhtml_giftcard_index>

    <!-- Gift Card History Grid Page -->
    <adminhtml_giftcard_history_index>
        <reference name="content">
            <block type="giftcard/adminhtml_giftcard_history" name="giftcard_history" />
        </reference>
    </adminhtml_giftcard_history_index>

    <!-- Gift Card Product Edit Page - Add tab and field toggle script -->
    <adminhtml_catalog_product_giftcard>
        <reference name="product_tabs">
            <action method="addTabAfter"><name>giftcard</name><block>giftcard/adminhtml_catalog_product_edit_tab_giftcard</block><after>group_9</after></action>
        </reference>
        <reference name="content">
            <block type="core/template" name="giftcard.type.toggle" template="maho/giftcard/catalog/product/type-toggle.phtml" />
        </reference>
    </adminhtml_catalog_product_giftcard>

    <!-- Add gift card totals to admin order views -->
    <!-- Gift card totals are added via block rewrite in config.xml -->

    <adminhtml_sales_order_invoice_view>
        <reference name="sales.order.view.totals.main">
            <block type="giftcard/adminhtml_sales_order_totals_item" name="giftcard" template="sales/order/totals/item.phtml" after="discount">
                <action method="setSourceField"><value>giftcard_amount</value></action>
                <action method="setDisplayZero"><value>false</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_view>

    <adminhtml_sales_order_creditmemo_view>
        <reference name="sales.order.view.totals.main">
            <block type="giftcard/adminhtml_sales_order_totals_item" name="giftcard" template="sales/order/totals/item.phtml" after="discount">
                <action method="setSourceField"><value>giftcard_amount</value></action>
                <action method="setDisplayZero"><value>false</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_creditmemo_view>

    <adminhtml_sales_order_invoice_new>
        <reference name="sales.order.view.totals.main">
            <block type="giftcard/adminhtml_sales_order_totals_item" name="giftcard" template="sales/order/totals/item.phtml" after="discount">
                <action method="setSourceField"><value>giftcard_amount</value></action>
                <action method="setDisplayZero"><value>false</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_new>

    <adminhtml_sales_order_creditmemo_new>
        <reference name="sales.order.view.totals.main">
            <block type="giftcard/adminhtml_sales_order_totals_item" name="giftcard" template="sales/order/totals/item.phtml" after="discount">
                <action method="setSourceField"><value>giftcard_amount</value></action>
                <action method="setDisplayZero"><value>false</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_creditmemo_new>

    <!-- Admin Order Create - Add gift card form next to coupons -->
    <adminhtml_sales_order_create_index>
        <reference name="head">
            <action method="addJs"><script>maho/giftcard/adminhtml/order.js</script></action>
        </reference>
        <reference name="items_grid">
            <block type="giftcard/adminhtml_sales_order_create_giftcard" template="maho/giftcard/sales/order/create/giftcard.phtml" name="giftcard" after="coupons" />
        </reference>
    </adminhtml_sales_order_create_index>

    <!-- Admin Order Edit (Reorder) - Add gift card form next to coupons -->
    <adminhtml_sales_order_edit_index>
        <reference name="head">
            <action method="addJs"><script>maho/giftcard/adminhtml/order.js</script></action>
        </reference>
        <reference name="items_grid">
            <block type="giftcard/adminhtml_sales_order_create_giftcard" template="maho/giftcard/sales/order/create/giftcard.phtml" name="giftcard" after="coupons" />
        </reference>
    </adminhtml_sales_order_edit_index>

    <!-- Admin Order Create - Load block items (for AJAX reload) -->
    <adminhtml_sales_order_create_load_block_items>
        <reference name="items_grid">
            <block type="giftcard/adminhtml_sales_order_create_giftcard" template="maho/giftcard/sales/order/create/giftcard.phtml" name="giftcard" after="coupons" />
        </reference>
    </adminhtml_sales_order_create_load_block_items>
</layout>
