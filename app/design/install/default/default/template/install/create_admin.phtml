<?php
/**
 * Maho
 *
 * @package     default_default
 * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://magento.com)
 * @copyright   Copyright (c) 2020-2024 The OpenMage Contributors (https://openmage.org)
 * @copyright   Copyright (c) 2024-2025 Maho (https://mahocommerce.com)
 * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/** @var Mage_Install_Block_Admin $this */
?>
<div class="page-head">
    <h3><?= $this->__('Create Admin Account') ?></h3>
</div>
<?= $this->getMessagesBlock()->toHtml() ?>
<form action="<?= $this->getPostUrl() ?>" method="post" id="form-validate">
<h4 class="section-title"><?= $this->__('Personal Information') ?></h4>
<div class="form-list">
    <ul>
        <li>
            <label for="firstname"><?= $this->__('First Name') ?> <span class="required">*</span></label>
            <input type="text" name="admin[firstname]" id="firstname" value="<?= $this->getFormData()->getFirstname() ?>" title="<?= $this->quoteEscape($this->__('First Name')) ?>" class="required-entry input-text"/>
        </li>
        <li>
            <label for="lastname"><?= $this->__('Last Name') ?> <span class="required">*</span></label>
            <input type="text" name="admin[lastname]" id="lastname" value="<?= $this->getFormData()->getLastname() ?>" title="<?= $this->quoteEscape($this->__('Last Name')) ?>" class="required-entry input-text"/>
        </li>
        <li>
            <label for="email_address"><?= $this->__('Email') ?> <span class="required">*</span></label>
            <input type="text" name="admin[email]" id="email_address" value="<?= $this->getFormData()->getEmail() ?>" title="<?= $this->quoteEscape($this->__('Email Address')) ?>" class="validate-email required-entry input-text"/>
        </li>
    </ul>
</div>

<h4 class="section-title"><?= $this->__('Login Information') ?></h4>
<div class="form-list">
    <ul>
        <li>
            <label for="username"><?= $this->__('Username') ?> <span class="required">*</span></label>
            <input type="text" name="admin[username]" id="username" value="<?= $this->getFormData()->getUsername() ?>" title="<?= $this->quoteEscape($this->__('Username')) ?>" class="required-entry input-text"/>
        </li>
        <li>
            <label for="password"><?= $this->__('Password') ?> <span class="required">*</span></label>
            <!-- This is a dummy hidden field to trick firefox from auto filling the password -->
            <input type="password" class="input-text" name="dummy" id="dummy" style="display: none;"/>
            <?php $minAdminPasswordLength = $this->getMinAdminPasswordLength(); ?>
            <input type="password"
                   name="admin[new_password]"
                   id="password"
                   title="<?= $this->quoteEscape($this->__('Password')) ?>"
                   class="required-entry validate-admin-password input-text min-admin-pass-length-<?= $minAdminPasswordLength ?>"
                   autocomplete="new-password"/>
            <p class="field-note">
                <small><?= Mage::helper('adminhtml')->__('Password must be at least of %d characters.', $minAdminPasswordLength) ?></small>
            </p>
        </li>
        <li>
            <label for="confirmation"><?= $this->__('Confirm Password') ?> <span class="required">*</span></label>
            <!-- This is a dummy hidden field to trick firefox from auto filling the password -->
            <input type="password" class="input-text" name="dummy" id="dummy" style="display: none;"/>
            <input type="password" name="admin[password_confirmation]" title="<?= $this->quoteEscape($this->__('Password Confirmation')) ?>" id="confirmation" class="required-entry validate-cpassword input-text" autocomplete="new-password"/>
        </li>
    </ul>
</div>
<div class="button-set">
    <p class="required">* <?= $this->__('Required Fields') ?></p>
    <button class="form-button" type="submit"><span><?= $this->__('Continue') ?></span></button>
</div>
</form>

<div id="installation-overlay" class="installation-overlay" style="display: none;">
    <div class="installation-overlay-content">
        <div class="installation-spinner"></div>
        <h2><?= $this->__('Creating Your Admin Account') ?></h2>
        <p><?= $this->__('Just a moment...') ?></p>
    </div>
</div>

<script type="text/javascript">
    var dataForm = new VarienForm('form-validate');

    // Show installation overlay on form submit
    document.getElementById('form-validate').addEventListener('submit', function(e) {
        // Only show overlay if form is valid
        if (this.checkValidity()) {
            document.getElementById('installation-overlay').style.display = 'flex';
            document.body.classList.add('installation-active');
        }
    });
</script>
