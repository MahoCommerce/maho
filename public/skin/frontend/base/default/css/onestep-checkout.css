/**
 * Maho
 *
 * @copyright  Copyright (c) 2026 Maho (https://mahocommerce.com)
 * @license    https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/* Header with title and login */
.onestep-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 0.5rem;

    h1 {
        margin: 0;
    }
}

.onestep-login-bar {
    display: flex;
    align-items: center;
    gap: 1rem;

    .onestep-login-text {
        color: var(--maho-color-text-secondary);
        font-size: 0.9rem;
    }

    .button {
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
    }
}

/* Main checkout container - 2 column layout */
.onestep-checkout {
    display: grid;
    grid-template-columns: 1.4fr 1fr;
    gap: 1.75rem;
    align-items: start;

    /* Left column - address forms */
    .onestep-column {
        display: flex;
        flex-direction: column;
        gap: 1.75rem;
        min-width: 0;
        position: sticky;
        top: 1rem;
    }

    /* Right column - methods and summary stacked */
    .onestep-column-right {
        display: flex;
        flex-direction: column;
        gap: 1.75rem;
        min-width: 0;
        position: sticky;
        top: 1rem;
    }

    .onestep-column-methods,
    .onestep-column-summary {
        display: flex;
        flex-direction: column;
        gap: 1.75rem;
    }

    /* Sections */
    .onestep-section {
        background: var(--maho-color-background);
        border: 1px solid var(--maho-color-border-light);
        overflow: hidden;

        &.loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;

            &::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 28px;
                height: 28px;
                margin: -14px 0 0 -14px;
                border: 2.5px solid var(--maho-color-primary);
                border-top-color: transparent;
                border-radius: 50%;
                animation: spin 0.8s linear infinite;
            }
        }
    }

    .onestep-section-header {
        padding: 1rem 1.25rem;
        background: var(--maho-color-primary);

        h2 {
            margin: 0;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: white;
        }
    }

    .onestep-section-content {
        padding: 1.25rem;
    }

    #onestep-review .onestep-section-content {
        padding: 0;
    }

    /* Hide elements not needed in one-step checkout */
    #billing-buttons-container,
    #shipping-buttons-container,
    #shipping-method-buttons-container,
    #payment-buttons-container,
    .buttons-set .button:not(.btn-checkout),
    .buttons-set a.continue-shopping,
    .step-title,
    .opc,
    p.required {
        display: none;
    }

    /* Hide empty containers in shipping/payment sections */
    #checkout-shipping-method-load:empty,
    #checkout-payment-method-load:empty,
    #onepage-checkout-shipping-method-additional-load:empty {
        display: none;
    }

    /* Hide the shipping method form completely when load area is empty */
    #co-shipping-method-form:has(#checkout-shipping-method-load:empty) {
        display: none;
    }

    /* Form styling - 2 column grid layout */
    .form-list {
        margin: 0;
        padding: 0;

        /* Reset legacy float-based layouts */
        fieldset,
        ul,
        .field,
        .input-box {
            width: 100% !important;
            max-width: 100% !important;
            float: none !important;
            min-width: 0 !important;
        }

        /* The actual field list inside fieldset */
        fieldset > ul {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem 1rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        /* Default: each li takes one column */
        li {
            margin: 0;
        }

        /* Full-width fields - span both columns */
        li.wide {
            grid-column: 1 / -1;
        }

        /* Fields with multiple inputs use internal grid */
        li.fields {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem 1rem;

            .field {
                margin: 0;
            }
        }

        /* Name fields wrapper (first, middle, last) uses 3-column grid */
        .customer-name-middlename {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem 1rem;

            .field {
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
            }
        }

        li.fields:has(.customer-name-middlename) {
            display: block;
        }

        .field,
        .input-box {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 0.375rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--maho-color-text-secondary);
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="password"],
        select,
        textarea,
        .input-text {
            width: 100% !important;
            max-width: 100% !important;
            height: auto !important;
            padding: 0.5rem 0.75rem;
            font-size: 0.9375rem;
            color: var(--maho-color-text-primary);
            background: white;
            border: 1px solid var(--maho-color-border);
            box-sizing: border-box;

            &:focus {
                outline: none;
                border-color: var(--maho-color-primary);
            }
        }

        select,
        select.validate-select {
            cursor: pointer;
            appearance: none !important;
            -webkit-appearance: none !important;
            background-color: white !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 0.5rem center !important;
            background-repeat: no-repeat !important;
            background-size: 1.5em 1.5em !important;
            padding-right: 2.5rem !important;
        }

        .required em {
            color: var(--maho-color-error);
            font-style: normal;
        }
    }

    /* Shipping method styling - selectable cards */
    .sp-methods {
        margin: 0;
        padding: 0;
        list-style: none;

        dt {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--maho-color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 0.5rem;
        }

        dd {
            margin: 0 0 0.5rem 0;

            label {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.5rem 0;
                cursor: pointer;
                font-weight: 500;
            }

            input[type="radio"] {
                accent-color: var(--maho-color-primary);
                width: 16px;
                height: 16px;
                margin: 0;
            }

            input[type="radio"]:checked + label,
            label:has(input[type="radio"]:checked) {
                color: var(--maho-color-primary);
            }
        }
    }

    /* Payment method styling */
    .payment-methods {
        margin: 0;
        padding: 0;

        dt {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: white;
            border: 1px solid var(--maho-color-border-light);
            cursor: pointer;
            font-weight: 500;
            margin-bottom: 0.5rem;

            &:hover {
                border-color: var(--maho-color-primary);
            }

            input[type="radio"] {
                accent-color: var(--maho-color-primary);
                width: 16px;
                height: 16px;
                margin: 0;
            }

            &:has(input[type="radio"]:checked) {
                border-color: var(--maho-color-primary);
                background: var(--maho-color-background-alt);
            }
        }

        dd {
            margin: 0;
            padding: 0 0 1rem 0;
        }
    }

    /* Gift card styling */
    #payment-method-form {
        .input-box {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;

            input {
                flex: 1;
            }

            .button {
                white-space: nowrap;
            }
        }
    }

    /* Order review / summary styling */
    .checkout-review-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;

        thead {
            th {
                padding: 0.75rem 0.5rem;
                font-size: 0.625rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.03em;
                color: var(--maho-color-text-secondary);
                border-bottom: 1px solid var(--maho-color-border-light);
                text-align: left;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;

                /* Column widths */
                &:nth-child(1) { width: 40%; } /* Product */
                &:nth-child(2) { width: 20%; } /* Price */
                &:nth-child(3) { width: 15%; text-align: center; } /* Qty */
                &:nth-child(4) { width: 25%; text-align: right; } /* Subtotal */
            }
        }

        tbody {
            td {
                padding: 0.75rem 0.5rem;
                vertical-align: top;
                border-bottom: 1px solid var(--maho-color-border-light);
                overflow: hidden;
                text-overflow: ellipsis;
                font-size: 0.875rem;

                &:nth-child(3) {
                    text-align: center;
                }

                &:last-child {
                    text-align: right;
                    font-weight: 600;
                }

                .product-name {
                    font-weight: 500;
                    color: var(--maho-color-text-primary);
                    display: block;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
            }
        }

        tfoot {
            tr:first-child td {
                border-top: 1px solid var(--maho-color-border-light);
            }

            td {
                padding: 0.5rem;
                border-bottom: none;
                font-size: 0.875rem;

                &:last-child {
                    text-align: right;
                    font-weight: 600;
                }
            }

            tr:last-child td {
                padding-top: 0.75rem;
                font-size: 1rem;
                font-weight: 700;
                color: var(--maho-color-text-primary);
                border-top: 1px solid var(--maho-color-border-light);
            }
        }
    }

    /* Buttons */
    .buttons-set {
        margin-top: 0;
    }

    /* Review section buttons */
    #onestep-review .buttons-set {
        margin: 0;
        padding: 1.25rem;
        border-top: 1px solid var(--maho-color-border-light);
    }

    /* Place Order button */
    .btn-checkout,
    #onestep-place-order {
        width: 100%;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        background: var(--maho-color-primary);
        border: none;
        cursor: pointer;

        &:hover:not(:disabled) {
            background: var(--maho-color-primary-dark);
        }

        &:disabled,
        &.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
    }

    /* Please wait indicators */
    .please-wait {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding: 1.25rem;
        color: var(--maho-color-text-secondary);
        font-size: 0.875rem;

        img {
            width: 20px;
            height: 20px;
        }
    }

    /* Placeholder messages */
    .onestep-placeholder {
        text-align: center;
        padding: 2rem 1rem;
        color: var(--maho-color-text-secondary);

        p {
            margin: 0;
            font-size: 0.875rem;
            font-style: italic;
        }
    }

    /* Agreements styling */
    .checkout-agreements {
        margin: 1.25rem 0;
        padding: 0 1.5rem;
        list-style: none;

        li {
            margin-bottom: 1rem;
        }

        .agreement-content {
            max-height: 120px;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border: 1px solid var(--maho-color-border-light);
            font-size: 0.8125rem;
            line-height: 1.5;
            color: var(--maho-color-text-secondary);
        }

        .agree {
            display: flex;
            align-items: flex-start;
            gap: 0.625rem;

            input[type="checkbox"] {
                margin-top: 0.125rem;
                accent-color: var(--maho-color-primary);
                width: 16px;
                height: 16px;
            }

            label {
                font-size: 0.875rem;
                color: var(--maho-color-text-primary);
            }
        }
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Responsive: Tablet */
@media (max-width: 1024px) {
    .onestep-checkout {
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }
}

/* Responsive: Mobile */
@media (max-width: 768px) {
    .onestep-header {
        flex-wrap: wrap;
        gap: 1rem;
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;

        .page-title h1 {
            font-size: 1.5rem;
        }
    }

    .onestep-login-text {
        display: none;
    }

    .onestep-checkout {
        grid-template-columns: 1fr;
        gap: 1.25rem;

        .onestep-column,
        .onestep-column-right {
            position: static;
        }

        .onestep-section-content {
            padding: 1.25rem;
        }

        /* Single column form on mobile */
        .form-list {
            fieldset > ul {
                grid-template-columns: 1fr;
            }

            li.fields {
                grid-template-columns: 1fr;
            }

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="password"],
            select,
            textarea {
                padding: 0.75rem;
                font-size: 1rem; /* Prevent zoom on iOS */
            }
        }

        .btn-checkout,
        #onestep-place-order {
            padding: 1rem 1.5rem;
            font-size: 1rem;
        }
    }
}
