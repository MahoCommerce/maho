<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products API Tests - Maho API Test Harness</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div x-data="productTests()" class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8">
            <a href="index.html" class="text-blue-400 hover:text-blue-300 text-sm">&larr; Back to Dashboard</a>
            <h1 class="text-3xl font-bold text-white mt-2">Products API Tests</h1>
            <p class="text-gray-400">Test product catalog queries with filtering, sorting, and pagination</p>
        </header>

        <!-- M2 Parity Checklist -->
        <div class="bg-gray-800 rounded-lg p-4 mb-8">
            <h2 class="text-lg font-semibold mb-3">M2 Feature Parity Checklist</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>List Products</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Get Product</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Search by SKU</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Search by Name</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Category Filter</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                    <span>Attribute Filters</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Price Range</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Pagination</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Sort by Price</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                    <span>Sort by Name</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                    <span>Aggregations</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span>
                    <span>Related Products</span>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 mb-6 border-b border-gray-700">
            <button @click="activeTab = 'search'"
                    :class="activeTab === 'search' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                    class="px-4 py-2 border-b-2 font-medium">Search</button>
            <button @click="activeTab = 'detail'"
                    :class="activeTab === 'detail' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                    class="px-4 py-2 border-b-2 font-medium">Get Product</button>
            <button @click="activeTab = 'category'"
                    :class="activeTab === 'category' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                    class="px-4 py-2 border-b-2 font-medium">By Category</button>
            <button @click="activeTab = 'graphql'"
                    :class="activeTab === 'graphql' ? 'border-blue-500 text-blue-400' : 'border-transparent text-gray-400'"
                    class="px-4 py-2 border-b-2 font-medium">GraphQL</button>
        </div>

        <!-- Search Tab -->
        <div x-show="activeTab === 'search'" class="space-y-6">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Product Search</h3>

                <!-- Search Input -->
                <div class="flex gap-2 mb-4">
                    <input type="text" x-model="search.query" placeholder="Search by name or SKU..."
                           @keyup.enter="searchProducts()"
                           class="flex-1 bg-gray-700 rounded px-3 py-2">
                    <button @click="searchProducts()"
                            :disabled="loading"
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                        Search
                    </button>
                </div>

                <!-- Filters Row -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
                    <!-- Sort By -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Sort By</label>
                        <select x-model="search.sortBy" class="w-full bg-gray-700 rounded px-3 py-2 text-sm">
                            <option value="">Relevance</option>
                            <option value="name">Name</option>
                            <option value="price">Price</option>
                            <option value="created_at">Newest</option>
                            <option value="position">Position</option>
                        </select>
                    </div>

                    <!-- Sort Direction -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Direction</label>
                        <select x-model="search.sortDir" class="w-full bg-gray-700 rounded px-3 py-2 text-sm">
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>

                    <!-- Price Min -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Min Price</label>
                        <input type="number" x-model="search.priceMin" placeholder="0"
                               class="w-full bg-gray-700 rounded px-3 py-2 text-sm">
                    </div>

                    <!-- Price Max -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Max Price</label>
                        <input type="number" x-model="search.priceMax" placeholder="999"
                               class="w-full bg-gray-700 rounded px-3 py-2 text-sm">
                    </div>

                    <!-- Page Size -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Page Size</label>
                        <select x-model="search.pageSize" class="w-full bg-gray-700 rounded px-3 py-2 text-sm">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>

                <!-- Stock Filter -->
                <div class="flex items-center gap-4 mb-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" x-model="search.inStockOnly" class="rounded bg-gray-700">
                        <span class="text-sm text-gray-400">In Stock Only</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" x-model="search.enabledOnly" class="rounded bg-gray-700">
                        <span class="text-sm text-gray-400">Enabled Only</span>
                    </label>
                </div>
            </div>

            <!-- Results -->
            <div x-show="search.results" class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-gray-400">Found</span>
                        <span class="font-semibold" x-text="search.total"></span>
                        <span class="text-gray-400">products</span>
                        <span class="text-xs text-gray-500 ml-2" x-text="search.time + 'ms'"></span>
                    </div>

                    <!-- Pagination -->
                    <div class="flex items-center gap-2">
                        <button @click="search.page > 1 && (search.page--, searchProducts())"
                                :disabled="search.page <= 1"
                                class="bg-gray-700 hover:bg-gray-600 disabled:opacity-50 px-3 py-1 rounded text-sm">
                            Prev
                        </button>
                        <span class="text-sm">
                            Page <span x-text="search.page"></span>
                            of <span x-text="Math.ceil(search.total / search.pageSize) || 1"></span>
                        </span>
                        <button @click="search.page < Math.ceil(search.total / search.pageSize) && (search.page++, searchProducts())"
                                :disabled="search.page >= Math.ceil(search.total / search.pageSize)"
                                class="bg-gray-700 hover:bg-gray-600 disabled:opacity-50 px-3 py-1 rounded text-sm">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Products Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="product in search.results" :key="product.id || product.sku">
                        <div class="bg-gray-900 rounded p-4">
                            <div class="flex gap-3">
                                <div class="w-16 h-16 bg-gray-800 rounded flex items-center justify-center text-gray-600 text-xs flex-shrink-0">
                                    <template x-if="product.imageUrl || product.thumbnailUrl || product.smallImageUrl || product.image || product.thumbnail">
                                        <img :src="product.thumbnailUrl || product.smallImageUrl || product.imageUrl || product.image || product.thumbnail" class="w-16 h-16 object-cover rounded">
                                    </template>
                                    <template x-if="!product.imageUrl && !product.thumbnailUrl && !product.smallImageUrl && !product.image && !product.thumbnail">
                                        <span>No img</span>
                                    </template>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-medium truncate" x-text="product.name"></h4>
                                    <p class="text-xs text-gray-500 font-mono" x-text="product.sku"></p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-green-400 font-semibold" x-text="'$' + (product.finalPrice || product.price || 0).toFixed(2)"></span>
                                        <span x-show="product.finalPrice && product.finalPrice < product.price" class="text-xs text-red-400 line-through"
                                              x-text="'$' + (product.price || 0).toFixed(2)"></span>
                                    </div>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-xs px-2 py-0.5 rounded"
                                              :class="(product.stockStatus === 'in_stock' || product.isInStock || product.inStock) ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'"
                                              x-text="(product.stockStatus === 'in_stock' || product.isInStock || product.inStock) ? 'In Stock' : 'Out of Stock'"></span>
                                        <span class="text-xs text-gray-500" x-text="'Qty: ' + (product.stockQty || product.qty || 0)"></span>
                                    </div>
                                </div>
                            </div>
                            <button @click="viewProduct(product.id || product.sku)"
                                    class="w-full mt-3 bg-gray-700 hover:bg-gray-600 text-sm py-1 rounded">
                                View Details
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Raw Response -->
            <div x-show="search.response" class="bg-gray-800 rounded-lg p-6">
                <details>
                    <summary class="cursor-pointer text-sm text-gray-400 mb-2">Raw Response</summary>
                    <pre class="bg-gray-900 rounded p-3 text-xs overflow-auto max-h-64"><code x-text="search.response"></code></pre>
                </details>
            </div>
        </div>

        <!-- Get Product Tab -->
        <div x-show="activeTab === 'detail'" class="space-y-6">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Get Product</h3>

                <div class="flex gap-2 mb-2">
                    <div class="flex-1">
                        <input type="text" x-model="detail.identifier" placeholder="Product ID (e.g., 12345)"
                               class="w-full bg-gray-700 rounded px-3 py-2">
                    </div>
                    <button @click="getProduct('rest')"
                            :disabled="loading || !detail.identifier"
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                        REST (ID)
                    </button>
                    <button @click="getProduct('graphql')"
                            :disabled="loading || !detail.identifier"
                            class="bg-purple-600 hover:bg-purple-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                        GraphQL (ID)
                    </button>
                </div>
                <div class="flex gap-2 mb-4">
                    <div class="flex-1">
                        <input type="text" x-model="detail.sku" placeholder="SKU (e.g., ABC-123)"
                               class="w-full bg-gray-700 rounded px-3 py-2">
                    </div>
                    <button @click="getProductBySku()"
                            :disabled="loading || !detail.sku"
                            class="bg-purple-600 hover:bg-purple-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                        GraphQL (SKU)
                    </button>
                </div>
                <p class="text-xs text-gray-500 mb-4">REST only supports lookup by ID. SKU lookup requires GraphQL (admin session).</p>

                <!-- Fields Selection -->
                <div class="text-sm text-gray-400">
                    <span>Include:</span>
                    <label class="inline-flex items-center gap-1 ml-3">
                        <input type="checkbox" x-model="detail.includeMedia" class="rounded bg-gray-700">
                        <span>Media</span>
                    </label>
                    <label class="inline-flex items-center gap-1 ml-3">
                        <input type="checkbox" x-model="detail.includeStock" class="rounded bg-gray-700">
                        <span>Stock</span>
                    </label>
                    <label class="inline-flex items-center gap-1 ml-3">
                        <input type="checkbox" x-model="detail.includeCategories" class="rounded bg-gray-700">
                        <span>Categories</span>
                    </label>
                    <label class="inline-flex items-center gap-1 ml-3">
                        <input type="checkbox" x-model="detail.includeAttributes" class="rounded bg-gray-700">
                        <span>Attributes</span>
                    </label>
                </div>
            </div>

            <!-- Product Details -->
            <div x-show="detail.data" class="bg-gray-800 rounded-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Image -->
                    <div>
                        <div class="bg-gray-900 rounded aspect-square flex items-center justify-center">
                            <template x-if="detail.data?.imageUrl || detail.data?.smallImageUrl || detail.data?.image">
                                <img :src="detail.data.imageUrl || detail.data.smallImageUrl || detail.data.image" class="max-w-full max-h-full object-contain">
                            </template>
                            <template x-if="!detail.data?.imageUrl && !detail.data?.smallImageUrl && !detail.data?.image">
                                <span class="text-gray-600">No Image</span>
                            </template>
                        </div>
                    </div>

                    <!-- Info -->
                    <div class="md:col-span-2 space-y-4">
                        <div>
                            <h2 class="text-2xl font-bold" x-text="detail.data?.name"></h2>
                            <p class="text-gray-400 font-mono" x-text="'SKU: ' + detail.data?.sku"></p>
                        </div>

                        <div class="flex items-baseline gap-3">
                            <span class="text-3xl font-bold text-green-400" x-text="'$' + (detail.data?.finalPrice || detail.data?.price || 0).toFixed(2)"></span>
                            <span x-show="detail.data?.finalPrice && detail.data?.finalPrice < detail.data?.price" class="text-lg text-red-400 line-through"
                                  x-text="'$' + (detail.data?.price || 0).toFixed(2)"></span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-400">Status:</span>
                                <span :class="(detail.data?.status == 1 || detail.data?.status === 'enabled') ? 'text-green-400' : 'text-red-400'"
                                      x-text="(detail.data?.status == 1 || detail.data?.status === 'enabled') ? 'Enabled' : 'Disabled'"></span>
                            </div>
                            <div>
                                <span class="text-gray-400">Visibility:</span>
                                <span x-text="detail.data?.visibility || 'N/A'"></span>
                            </div>
                            <div>
                                <span class="text-gray-400">Type:</span>
                                <span x-text="detail.data?.typeId || detail.data?.type"></span>
                            </div>
                            <div>
                                <span class="text-gray-400">Stock:</span>
                                <span :class="(detail.data?.stockStatus === 'in_stock' || detail.data?.isInStock) ? 'text-green-400' : 'text-red-400'"
                                      x-text="((detail.data?.stockStatus === 'in_stock' || detail.data?.isInStock) ? 'In Stock' : 'Out of Stock') + ' (' + (detail.data?.stockQty || detail.data?.qty || 0) + ')'"></span>
                            </div>
                        </div>

                        <div x-show="detail.data?.description">
                            <span class="text-gray-400 text-sm">Description:</span>
                            <p class="text-sm mt-1" x-html="detail.data?.shortDescription || detail.data?.description?.substring(0, 200)"></p>
                        </div>

                        <!-- Categories (handle both formats) -->
                        <div x-show="detail.data?.categories || detail.data?.categoryIds">
                            <span class="text-gray-400 text-sm">Categories:</span>
                            <div class="flex flex-wrap gap-1 mt-1">
                                <!-- GraphQL format: array of {id, name} -->
                                <template x-if="Array.isArray(detail.data?.categories)">
                                    <template x-for="cat in detail.data?.categories || []" :key="cat.id || cat">
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded" x-text="cat.name || cat"></span>
                                    </template>
                                </template>
                                <!-- REST format: categoryIds object with level0, level1 arrays -->
                                <template x-if="detail.data?.categoryIds && !Array.isArray(detail.data?.categories)">
                                    <template x-for="cat in [...(detail.data?.categoryIds?.level0 || []), ...(detail.data?.categoryIds?.level1 || [])]" :key="cat">
                                        <span class="text-xs bg-gray-700 px-2 py-1 rounded" x-text="cat"></span>
                                    </template>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Raw Response -->
            <div x-show="detail.response" class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-sm font-medium">Response</span>
                    <span class="text-xs px-2 py-0.5 rounded"
                          :class="detail.status >= 200 && detail.status < 300 ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'"
                          x-text="detail.status"></span>
                    <span class="text-xs text-gray-500" x-text="detail.time + 'ms'"></span>
                </div>
                <pre class="bg-gray-900 rounded p-3 text-xs overflow-auto max-h-64"><code x-text="detail.response"></code></pre>
            </div>
        </div>

        <!-- By Category Tab -->
        <div x-show="activeTab === 'category'" class="space-y-6">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Products by Category</h3>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm text-gray-400 mb-1">Category ID</label>
                        <input type="number" x-model="category.id" placeholder="Enter category ID"
                               class="w-full bg-gray-700 rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Page Size</label>
                        <select x-model="category.pageSize" class="w-full bg-gray-700 rounded px-3 py-2">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button @click="getProductsByCategory()"
                                :disabled="loading || !category.id"
                                class="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                            Load Products
                        </button>
                    </div>
                </div>

                <!-- Include subcategories -->
                <label class="inline-flex items-center gap-2">
                    <input type="checkbox" x-model="category.includeSubcategories" class="rounded bg-gray-700">
                    <span class="text-sm text-gray-400">Include Subcategories</span>
                </label>
            </div>

            <!-- Category Products Results -->
            <div x-show="category.results" class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-gray-400">Found</span>
                        <span class="font-semibold" x-text="category.total"></span>
                        <span class="text-gray-400">products in category</span>
                    </div>
                    <!-- Pagination -->
                    <div class="flex items-center gap-2">
                        <button @click="category.page > 1 && (category.page--, getProductsByCategory())"
                                :disabled="category.page <= 1"
                                class="bg-gray-700 hover:bg-gray-600 disabled:opacity-50 px-3 py-1 rounded text-sm">
                            Prev
                        </button>
                        <span class="text-sm">Page <span x-text="category.page"></span></span>
                        <button @click="category.page++; getProductsByCategory()"
                                class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm">
                            Next
                        </button>
                    </div>
                </div>

                <!-- Products Table -->
                <table class="w-full text-sm">
                    <thead class="text-left text-gray-400 border-b border-gray-700">
                        <tr>
                            <th class="py-2">SKU</th>
                            <th class="py-2">Name</th>
                            <th class="py-2 text-right">Price</th>
                            <th class="py-2 text-center">Stock</th>
                            <th class="py-2">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="product in category.results" :key="product.id || product.sku">
                            <tr class="border-b border-gray-700/50">
                                <td class="py-2 font-mono text-xs" x-text="product.sku"></td>
                                <td class="py-2" x-text="product.name"></td>
                                <td class="py-2 text-right" x-text="'$' + (product.finalPrice || product.price || 0).toFixed(2)"></td>
                                <td class="py-2 text-center">
                                    <span class="text-xs px-2 py-0.5 rounded"
                                          :class="(product.stockStatus === 'in_stock' || product.isInStock) ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'"
                                          x-text="(product.stockStatus === 'in_stock' || product.isInStock) ? 'Yes' : 'No'"></span>
                                </td>
                                <td class="py-2">
                                    <button @click="viewProduct(product.id)" class="text-blue-400 hover:text-blue-300 text-xs">View</button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Raw Response -->
            <div x-show="category.response" class="bg-gray-800 rounded-lg p-6">
                <details>
                    <summary class="cursor-pointer text-sm text-gray-400 mb-2">Raw Response</summary>
                    <pre class="bg-gray-900 rounded p-3 text-xs overflow-auto max-h-64"><code x-text="category.response"></code></pre>
                </details>
            </div>
        </div>

        <!-- GraphQL Tab -->
        <div x-show="activeTab === 'graphql'" class="space-y-6">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">GraphQL Query</h3>

                <!-- Endpoint Selection -->
                <div class="mb-4 p-3 bg-gray-900 rounded">
                    <label class="block text-sm text-gray-400 mb-2">Endpoint</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="graphql.endpoint" value="public" class="text-blue-600">
                            <span><code class="text-blue-400">/api/graphql</code> <span class="text-gray-500">(Public - JWT auth)</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" x-model="graphql.endpoint" value="admin" class="text-purple-600">
                            <span><code class="text-purple-400">/admin/graphql/index</code> <span class="text-gray-500">(Admin session)</span></span>
                        </label>
                    </div>
                </div>

                <!-- JWT Token for public endpoint -->
                <div x-show="graphql.endpoint === 'public'" class="mb-4">
                    <label class="block text-sm text-gray-400 mb-1">JWT Token (from /api/auth/token)</label>
                    <input type="text" x-model="graphql.token" placeholder="Bearer token..."
                           class="w-full bg-gray-700 rounded px-3 py-2 font-mono text-sm">
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-1">Query</label>
                    <textarea x-model="graphql.query" rows="12"
                              class="w-full bg-gray-700 rounded px-3 py-2 font-mono text-sm"></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-1">Variables (JSON)</label>
                    <textarea x-model="graphql.variables" rows="3"
                              class="w-full bg-gray-700 rounded px-3 py-2 font-mono text-sm"></textarea>
                </div>

                <div class="flex gap-2 flex-wrap">
                    <button @click="runGraphQL()"
                            :disabled="loading"
                            class="bg-purple-600 hover:bg-purple-700 disabled:opacity-50 px-6 py-2 rounded font-medium">
                        Execute Query
                    </button>
                    <button @click="loadGraphQLExample('products')"
                            class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm">
                        List Products
                    </button>
                    <button @click="loadGraphQLExample('product')"
                            class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm">
                        Get Product
                    </button>
                    <button @click="loadGraphQLExample('search')"
                            class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm">
                        Search
                    </button>
                    <button @click="loadGraphQLExample('category')"
                            class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm">
                        By Category
                    </button>
                </div>
            </div>

            <!-- Response -->
            <div x-show="graphql.response" class="bg-gray-800 rounded-lg p-6">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-sm font-medium">Response</span>
                    <span class="text-xs px-2 py-0.5 rounded"
                          :class="graphql.status >= 200 && graphql.status < 300 ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'"
                          x-text="graphql.status"></span>
                    <span class="text-xs text-gray-500" x-text="graphql.time + 'ms'"></span>
                </div>
                <pre class="bg-gray-900 rounded p-3 text-xs overflow-auto max-h-96"><code x-text="graphql.response"></code></pre>
            </div>
        </div>
    </div>

    <script>
        function productTests() {
            return {
                activeTab: 'search',
                loading: false,

                search: {
                    query: '',
                    sortBy: '',
                    sortDir: 'asc',
                    priceMin: '',
                    priceMax: '',
                    pageSize: '20',
                    page: 1,
                    inStockOnly: false,
                    enabledOnly: true,
                    results: null,
                    total: 0,
                    time: null,
                    response: null
                },

                detail: {
                    identifier: '',
                    sku: '',
                    includeMedia: true,
                    includeStock: true,
                    includeCategories: false,
                    includeAttributes: false,
                    data: null,
                    response: null,
                    status: null,
                    time: null
                },

                category: {
                    id: '',
                    pageSize: '20',
                    page: 1,
                    includeSubcategories: true,
                    results: null,
                    total: 0,
                    response: null
                },

                graphql: {
                    endpoint: 'admin',
                    token: localStorage.getItem('authToken') || '',
                    query: `query Products($search: String, $pageSize: Int, $page: Int) {
    products(search: $search, pageSize: $pageSize, page: $page) {
        items {
            id
            sku
            name
            price
            isInStock
            image
        }
        totalCount
        pageInfo {
            currentPage
            pageSize
            totalPages
        }
    }
}`,
                    variables: '{"search": "", "pageSize": 10, "page": 1}',
                    response: null,
                    status: null,
                    time: null
                },

                async searchProducts() {
                    this.loading = true;
                    const start = Date.now();

                    try {
                        const params = new URLSearchParams();
                        if (this.search.query) params.append('search', this.search.query);
                        if (this.search.sortBy) params.append('sortBy', this.search.sortBy);
                        if (this.search.sortDir) params.append('sortDir', this.search.sortDir);
                        if (this.search.priceMin) params.append('priceMin', this.search.priceMin);
                        if (this.search.priceMax) params.append('priceMax', this.search.priceMax);
                        if (this.search.inStockOnly) params.append('inStock', '1');
                        if (this.search.enabledOnly) params.append('status', '1');
                        params.append('pageSize', this.search.pageSize);
                        params.append('page', this.search.page);

                        const res = await fetch('/api/products?' + params.toString());
                        const data = await res.json();

                        this.search.time = Date.now() - start;
                        this.search.response = JSON.stringify(data, null, 2);
                        // API Platform returns data in 'member' (JSON-LD) or 'hydra:member' format
                        this.search.results = data.member || data['hydra:member'] || data.items || data.products || data;
                        this.search.total = data.totalItems || data['hydra:totalItems'] || data.totalCount || data.total || this.search.results?.length || 0;
                    } catch (e) {
                        this.search.time = Date.now() - start;
                        this.search.response = 'Error: ' + e.message;
                        this.search.results = null;
                    }

                    this.loading = false;
                },

                async getProduct(method) {
                    this.loading = true;
                    const start = Date.now();

                    try {
                        let res, data;

                        if (method === 'rest') {
                            res = await fetch(`/api/products/${this.detail.identifier}`);
                            data = await res.json();
                        } else {
                            const query = `
                                query GetProduct($id: ID!) {
                                    product(id: $id) {
                                        id
                                        sku
                                        name
                                        price
                                        specialPrice
                                        description
                                        shortDescription
                                        status
                                        visibility
                                        typeId
                                        isInStock
                                        qty
                                        image
                                        categories {
                                            id
                                            name
                                        }
                                    }
                                }
                            `;
                            res = await fetch('/admin/graphql/index', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    query,
                                    variables: { id: this.detail.identifier }
                                })
                            });
                            const result = await res.json();
                            data = result.data?.product || result;
                        }

                        this.detail.status = res.status;
                        this.detail.time = Date.now() - start;
                        this.detail.response = JSON.stringify(data, null, 2);
                        this.detail.data = data;
                    } catch (e) {
                        this.detail.status = 0;
                        this.detail.time = Date.now() - start;
                        this.detail.response = 'Error: ' + e.message;
                        this.detail.data = null;
                    }

                    this.loading = false;
                },

                viewProduct(id) {
                    this.detail.identifier = String(id);
                    this.activeTab = 'detail';
                    this.getProduct('rest');
                },

                async getProductBySku() {
                    this.loading = true;
                    const start = Date.now();

                    try {
                        const query = `
                            query GetProductBySku($sku: String!) {
                                productBySku(sku: $sku) {
                                    id
                                    sku
                                    name
                                    price
                                    specialPrice
                                    description
                                    shortDescription
                                    status
                                    visibility
                                    typeId
                                    isInStock
                                    qty
                                    image
                                    categories {
                                        id
                                        name
                                    }
                                }
                            }
                        `;
                        const res = await fetch('/admin/graphql/index', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                query,
                                variables: { sku: this.detail.sku }
                            })
                        });
                        const result = await res.json();
                        const data = result.data?.productBySku || result;

                        this.detail.status = res.status;
                        this.detail.time = Date.now() - start;
                        this.detail.response = JSON.stringify(data, null, 2);
                        this.detail.data = data;
                    } catch (e) {
                        this.detail.status = 0;
                        this.detail.time = Date.now() - start;
                        this.detail.response = 'Error: ' + e.message;
                        this.detail.data = null;
                    }

                    this.loading = false;
                },

                async getProductsByCategory() {
                    this.loading = true;

                    try {
                        const params = new URLSearchParams();
                        params.append('categoryId', this.category.id);
                        params.append('pageSize', this.category.pageSize);
                        params.append('page', this.category.page);
                        if (this.category.includeSubcategories) {
                            params.append('includeSubcategories', '1');
                        }

                        const res = await fetch('/api/products?' + params.toString());
                        const data = await res.json();

                        this.category.response = JSON.stringify(data, null, 2);
                        // API Platform returns data in 'member' (JSON-LD) format
                        this.category.results = data.member || data['hydra:member'] || data.items || data.products || data;
                        this.category.total = data.totalItems || data['hydra:totalItems'] || data.totalCount || data.total || this.category.results?.length || 0;
                    } catch (e) {
                        this.category.response = 'Error: ' + e.message;
                        this.category.results = null;
                    }

                    this.loading = false;
                },

                loadGraphQLExample(type) {
                    const examples = {
                        products: {
                            query: `query Products($search: String, $pageSize: Int, $page: Int, $sortBy: String, $sortDir: SortDirection) {
    products(search: $search, pageSize: $pageSize, page: $page, sortBy: $sortBy, sortDir: $sortDir) {
        items {
            id
            sku
            name
            price
            specialPrice
            isInStock
            qty
            image
        }
        totalCount
        pageInfo {
            currentPage
            pageSize
            totalPages
        }
    }
}`,
                            variables: JSON.stringify({
                                search: '',
                                pageSize: 10,
                                page: 1,
                                sortBy: 'name',
                                sortDir: 'ASC'
                            }, null, 2)
                        },
                        product: {
                            query: `query GetProduct($id: ID, $sku: String) {
    product(id: $id, sku: $sku) {
        id
        sku
        name
        price
        specialPrice
        description
        shortDescription
        status
        visibility
        typeId
        weight
        isInStock
        qty
        image
        mediaGallery {
            url
            label
            position
        }
        categories {
            id
            name
            path
        }
        customAttributes {
            attributeCode
            value
        }
    }
}`,
                            variables: JSON.stringify({ id: '1', sku: null }, null, 2)
                        },
                        search: {
                            query: `query SearchProducts($search: String!, $filters: ProductFilterInput) {
    products(search: $search, filters: $filters, pageSize: 20) {
        items {
            id
            sku
            name
            price
            isInStock
        }
        totalCount
        aggregations {
            attributeCode
            label
            options {
                label
                value
                count
            }
        }
    }
}`,
                            variables: JSON.stringify({
                                search: 'tennis',
                                filters: {
                                    priceRange: { min: 10, max: 100 }
                                }
                            }, null, 2)
                        },
                        category: {
                            query: `query CategoryProducts($categoryId: ID!, $pageSize: Int, $page: Int) {
    categoryProducts(categoryId: $categoryId, pageSize: $pageSize, page: $page) {
        items {
            id
            sku
            name
            price
            isInStock
            image
        }
        totalCount
        pageInfo {
            currentPage
            totalPages
        }
    }
}`,
                            variables: JSON.stringify({ categoryId: '2', pageSize: 10, page: 1 }, null, 2)
                        }
                    };

                    if (examples[type]) {
                        this.graphql.query = examples[type].query;
                        this.graphql.variables = examples[type].variables;
                    }
                },

                async runGraphQL() {
                    this.loading = true;
                    const start = Date.now();

                    try {
                        let variables = {};
                        try {
                            variables = JSON.parse(this.graphql.variables || '{}');
                        } catch (e) {
                            // ignore parse errors
                        }

                        const url = this.graphql.endpoint === 'public' ? '/api/graphql' : '/admin/graphql/index';
                        const headers = { 'Content-Type': 'application/json' };

                        // Add JWT token for public endpoint
                        if (this.graphql.endpoint === 'public' && this.graphql.token) {
                            headers['Authorization'] = 'Bearer ' + this.graphql.token;
                        }

                        const res = await fetch(url, {
                            method: 'POST',
                            headers,
                            body: JSON.stringify({
                                query: this.graphql.query,
                                variables
                            })
                        });
                        const data = await res.json();

                        this.graphql.status = res.status;
                        this.graphql.time = Date.now() - start;
                        this.graphql.response = JSON.stringify(data, null, 2);
                    } catch (e) {
                        this.graphql.status = 0;
                        this.graphql.time = Date.now() - start;
                        this.graphql.response = 'Error: ' + e.message;
                    }

                    this.loading = false;
                }
            };
        }
    </script>
</body>
</html>
